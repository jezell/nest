From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jesse Ezell <jezell@users.noreply.github.com>
Date: Sun, 27 Mar 2025 14:49:01 -0800
Subject: Fix scrollbars and text selection in flutter web

diff --git a/engine/src/flutter/lib/web_ui/lib/src/engine/pointer_binding/event_position_helper.dart b/engine/src/flutter/lib/web_ui/lib/src/engine/pointer_binding/event_position_helper.dart
index 6a210c9a01..54719e25fb 100644
--- a/engine/src/flutter/lib/web_ui/lib/src/engine/pointer_binding/event_position_helper.dart
+++ b/engine/src/flutter/lib/web_ui/lib/src/engine/pointer_binding/event_position_helper.dart
@@ -82,6 +82,20 @@ ui.Offset _computeOffsetForInputs(
 ) {
   final DomElement targetElement = eventTarget as DomElement;
   final DomHTMLElement domElement = textEditing.strategy.activeDomElement;
+
+  double offsetX;
+  double offsetY;
+
+  if (event.target != targetElement) {
+    final boundsTarget = targetElement.getBoundingClientRect();
+    final boundsEvent = (event.target as DomElement).getBoundingClientRect();
+    offsetX = event.offsetX + (boundsEvent.left - boundsTarget.left);
+    offsetY = event.offsetY + (boundsEvent.top - boundsTarget.top);
+  } else {
+    offsetX = event.offsetX;
+    offsetY = event.offsetY;
+  }
+
   assert(
     targetElement == domElement,
     'The targeted input element must be the active input element',
@@ -89,11 +103,7 @@ ui.Offset _computeOffsetForInputs(
   final Float32List transformValues = inputGeometry.globalTransform;
   assert(transformValues.length == 16);
   final Matrix4 transform = Matrix4.fromFloat32List(transformValues);
-  final Vector3 transformedPoint = transform.perspectiveTransform(
-    x: event.offsetX,
-    y: event.offsetY,
-    z: 0,
-  );
+  final Vector3 transformedPoint = transform.perspectiveTransform(x: offsetX, y: offsetY, z: 0);
 
   return ui.Offset(transformedPoint.x, transformedPoint.y);
 }
 